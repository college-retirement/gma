angular.module("gmaApp",["gmaApp.filters","ngRoute","ngAnimate","ui.utils","ui.bootstrap","persona","colleges"]),angular.module("gmaApp.filters",[]),angular.module("gmaApp").config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"assets/views/home.html",controller:"MainCtrl"}).when("/profile",{templateUrl:"assets/views/initialData.html",controller:"ProfileCtrl",resolve:{isDraft:function(){return!0},moreInfo:function(){return!1},profile:function(){return!1}}}).when("/moreinfo/:profileid",{templateUrl:"assets/views/initialData.html",controller:"ProfileCtrl",resolve:{isDraft:function(){return!1},moreInfo:function(){return!0},profile:["$route","$http",function(a,b){return b.get("/profiles/"+a.current.params.profileid).then(function(a){return a.data.result})}]}}).when("/register",{templateUrl:"assets/views/register.html",controller:"RegisterCtrl"}).when("/drafts/:draft",{templateUrl:"assets/views/initialData.html",controller:"ProfileCtrl",resolve:{isDraft:function(){return!0},moreInfo:function(){return!1},profile:["$route","$http",function(a,b){return b.get("/drafts/"+a.current.params.draft).then(function(a){return a.data})}]}}).when("/admin",{templateUrl:"assets/views/admin/home.html",controller:"AdminCtrl"}).when("/admin/list",{templateUrl:"assets/views/admin/profiles/list.html",controller:"AdminListCtrl"}).when("/admin/profiles/:profile",{templateUrl:"assets/views/admin/profiles/view.html",controller:"AdminViewCtrl",reloadOnSearch:!1}).when("/admin/drafts/:profile",{templateUrl:"assets/views/admin/drafts/view.html",controller:"AdminDraftViewCtrl"}).when("/admin/drafts",{templateUrl:"assets/views/admin/drafts/list.html",controller:"AdminDraftListCtrl",reloadOnSearch:!1}).when("/admin/users",{templateUrl:"assets/views/admin/users/list.html",controller:"AdminUserListCtrl"}).when("/admin/users/:user",{templateUrl:"assets/views/admin/users/view.html",controller:"AdminUserViewCtrl"}).otherwise("/"),b.interceptors.push("UnauthorizedXHRInterceptor")}]),angular.module("gmaApp").factory("UnauthorizedXHRInterceptor",["$location","$q",function(a,b){return{responseError:function(c){return"/persona/status"!==c.url&&401==c.status&&(b.reject(c),a.path("/")),b.reject(c)}}}]),angular.module("gmaApp").controller("AppCtrl",["$rootScope","$scope","Persona",function(){}]),angular.module("gmaApp").controller("MainCtrl",["$rootScope","$scope","Persona","$timeout","$http",function(a,b,c,d,e){c.status(),b.drafts=[],b.login=function(){b.$emit("loginClick")},b.getUser=function(){return c.getUser()},b.getDrafts=function(){e.get("/drafts").then(function(a){b.drafts=a.data.drafts})},b.getUser()!==!1&&b.getDrafts(),b.$watch("getUser()",function(a){a!==!1&&b.getDrafts()}),b.draftDelete=function(a){e.delete("/drafts/"+a._id).then(function(){toastr.success("Draft deleted successfully."),e.get("/drafts").then(function(a){b.drafts=a.data.drafts})})}}]),angular.module("gmaApp").controller("PersonaCtrl",["$rootScope","$scope","Persona",function(a,b,c){b.login=function(){c.verify()},b.logout=function(){c.logout()},b.status=function(){c.status()},b.getUser=function(){return c.getUser()},a.$on("loginClick",function(){b.login()})}]),angular.module("gmaApp").controller("MoreInfoCtrl",["$scope","$http","$route","$location","Persona","states","AssetTypes","OwnershipTypes","LiabilityTypes","RetirementTypes",function(a,b,c,d,e,f){e.status(),a.getUser=function(){return e.getUser()},a.states=f,c.current.params.hasOwnProperty("profileid")&&b.get("/profiles/"+c.current.params.profileid).then(function(b){a.student=b.data.result}),a.submitProfile=function(){var d=!1;jQuery(".has-error").removeClass("has-error"),jQuery(".ng-invalid").each(function(){d=!0,jQuery(this).parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".btn.ng-invalid").each(function(){d=!0,jQuery(this).parent(".btn-group").parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".input-group>.ng-invalid").each(function(){d=!0,jQuery(this).parent(".input-group").parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".ng-invalid:not(form)").first().focus(),a.submit=!0,d||b.put("/profiles/"+c.current.params.profileid,a.student).success(function(){a.finished=!0}).error(function(){toastr.error("Unable to update account.")})}}]),angular.module("gmaApp").controller("ProfileCtrl",["$scope","$http","$route","$location","Persona","states","AssetTypes","OwnershipTypes","LiabilityTypes","RetirementTypes","moreInfo","profile","isDraft","Colleges",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){e.status(),a.getUser=function(){return e.getUser()},a.moreInfo=k,c.current.params.hasOwnProperty("draft")&&b.get("/drafts/"+c.current.params.draft).then(function(b){a.student=b.data,a.continue=!0,a.draftLoaded=!0}),a.variableRequirements={fafsa:!1,css:!1},a.states=f,a.currentSchool=null,a.currentSibSchool=null,a.collegeList={},a.collegesLoading=!1,a.ownershipTypes=h,a.liabilityTypes=i,a.assetTypes=g,a.retirementTypes=j,a.stronghold={},0==l?(a.makeNew=!0,a.student={prospect:!0,email:null,dependents:0,livingArrangement:null,income:{earnedIncome:0,unearnedIncome:0,taxPaid:0,agi:0,itemizedDeductions:0,ssBenefits:0,iraContribution:0},schools:[],siblings:{schools:[]},family:{monthlyHouseholdExpense:0,contributionAbility:0,members:[],realEstate:[],assets:[],liabilities:[],retirement:[],home:{price:0,value:0,propertyTax:0}},guardian:{income:{current:0,anticipated:0,retirement:0,ssBenefits:0}},parents:{income:{father:{current:0,anticipated:0,retirement:0,ssBenefits:0},mother:{current:0,anticipated:0,retirement:0,ssBenefits:0},combined:{other:0,untaxed:0,childSupport:{received:0,paid:0},housing:0,medical:0,deductions:0,taxPaid:0,agi:0}}},school:{current:!1,name:null,grade:null,parentContribution:0}}):m?(a.student=l,a.makeNew=!0):(a.student=l,a.student.status="Additional Information Received",a.makeNew=!1),a.$watch("currentSchool",function(){""!=a.currentSchool&&"object"!=typeof a.currentSchool&&(a.collegesLoading=!0,b.post("/colleges.json",{name:a.currentSchool}).then(function(b){a.collegeList=b.data,a.collegesLoading=!1}))}),a.$watch("currentSibSchool",function(){""!=a.currentSibSchool&&"object"!=typeof a.currentSibSchool&&(a.collegesLoading=!0,b.post("/colleges.json",{name:a.currentSibSchool}).then(function(b){a.collegeSibList=b.data,a.collegesLoading=!1}))}),a.checkRequirements=function(){if(a.moreInfo!==!1)for(var b in a.student.schools){var c=a.student.schools[b];if(c.hasOwnProperty("finAid"))c.finAid.css_profile===!0&&(a.variableRequirements.css=!0),c.finAid.fafsa===!0&&(a.variableRequirements.fafsa=!0);else{var d=n.getSchool(c.cb_id);d.then(function(a){c.finAid=a.data.result.college.financial_aid.requirements})}}},a.checkRequirements(),a.addSchool=function(b){if(b===!0)a.student.siblings.schools.push(a.currentSibSchool),a.currentSibSchool=null;else{var c=n.getSchool(a.currentSchool.cb_id);c.then(function(b){a.currentSchool.finAid=b.data.result.college.financial_aid.requirements,a.student.schools.push(a.currentSchool),a.checkRequirements(),a.currentSchool=null})}},a.updateSchool=function(b,c,d){d===!0?a.currentSibSchool=b:a.currentSchool=b},a.deleteSchool=function(b,c){c?a.student.siblings.schools.splice(b,1):a.student.schools.splice(b,1)},a.addFamily=function(){a.student.family.members.push({student:!1})},a.deleteFamily=function(b){a.student.family.members.splice(b,1)},a.addProperty=function(){a.student.family.realEstate.push({})},a.deleteProperty=function(b){a.student.family.realEstate.splice(b,1)},a.addAsset=function(){a.student.family.assets.push({})},a.deleteAsset=function(b){a.student.family.assets.splice(b,1)},a.addLiability=function(){a.student.family.liabilities.push({})},a.deleteLiability=function(b){a.student.family.liabilities.splice(b,1)},a.addRetirement=function(){a.student.family.retirement.push({})},a.deleteRetirement=function(b){a.student.family.retirement.splice(b,1)},a.submitProfile=function(){var c=!1;jQuery(".has-error").removeClass("has-error"),jQuery(".ng-invalid").each(function(){c=!0,jQuery(this).parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".btn.ng-invalid").each(function(){c=!0,jQuery(this).parent(".btn-group").parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".input-group>.ng-invalid").each(function(){c=!0,jQuery(this).parent(".input-group").parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".ng-invalid:not(form)").first().focus(),a.submit=!0,c||(a.makeNew?b.post("/profiles",a.student).success(function(){a.finished=!0}).error(function(){toastr.error("Unable to submit profile.")}):b.put("/profiles/"+a.student._id,a.student).success(function(){a.finished=!0}).error(function(){toastr.error("Unable to submit profile.")}))},a.saveDraft=function(){b.post("/drafts",a.student).success(function(b){toastr.success("Draft saved successfully!"),a.student=b}).error(function(){toastr.warning("There were issues saving your draft.")})}}]),angular.module("gmaApp").controller("RegisterCtrl",["$scope","$http","$location","Persona",function(a,b){a.done=!1,a.submit=function(){var c=!1;jQuery(".has-error").removeClass("has-error"),jQuery(".ng-invalid").each(function(){c=!0,jQuery(this).parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".btn.ng-invalid").each(function(){c=!0,jQuery(this).parent(".btn-group").parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".input-group>.ng-invalid").each(function(){c=!0,jQuery(this).parent(".input-group").parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".ng-invalid:not(form)").first().focus(),a.submitted=!0,c||b.post("/accounts",a.user).success(function(){a.done=!0}).error(function(a){toastr.error(a.hasOwnProperty("messages")&&a.messages.hasOwnProperty("duplicate_email")?"There is an account with this email already.":"Unable to create account.")})},a.login=function(){a.$emit("loginClick")}}]),angular.module("gmaApp").controller("AdminCtrl",["$scope","Persona",function(){}]),angular.module("gmaApp").controller("AdminEditCtrl",["$scope","$route","$http","$location","Persona","$modal","states","AssetTypes","OwnershipTypes","LiabilityTypes","RetirementTypes",function(a,b,c,d,e,f,g,h,i,j,k){a.currentSchool=null,a.collegeList={},a.collegesLoading=!1,a.$watch("currentSchool",function(){""!=a.currentSchool&&"object"!=typeof a.currentSchool&&(a.collegesLoading=!0,c.post("/colleges.json",{name:a.currentSchool}).then(function(b){a.collegeList=b.data,a.collegesLoading=!1}))}),a.ownershipTypes=i,a.liabilityTypes=j,a.assetTypes=h,a.retirementTypes=k,a.addSchool=function(){a.student.schools.push(a.currentSchool),a.currentSchool=null},a.updateSchool=function(b){a.currentSchool=b},a.deleteSchool=function(b){a.student.schools.splice(b,1)},a.addFamily=function(){a.student.family.members.push({student:!1})},a.deleteFamily=function(b){a.student.family.members.splice(b,1)},a.addProperty=function(){a.student.family.realEstate.push({})},a.deleteProperty=function(b){a.student.family.realEstate.splice(b,1)},a.addAsset=function(){a.student.family.assets.push({})},a.deleteAsset=function(b){a.student.family.assets.splice(b,1)},a.addLiability=function(){a.student.family.liabilities.push({})},a.deleteLiability=function(b){a.student.family.liabilities.splice(b,1)},a.addRetirement=function(){a.student.family.retirement.push({})},a.deleteRetirement=function(b){a.student.family.retirement.splice(b,1)},a.submitProfile=function(){var b=!1;jQuery(".has-error").removeClass("has-error"),jQuery(".ng-invalid").each(function(){b=!0,jQuery(this).parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".btn.ng-invalid").each(function(){b=!0,jQuery(this).parent(".btn-group").parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".input-group>.ng-invalid").each(function(){b=!0,jQuery(this).parent(".input-group").parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".ng-invalid:not(form)").first().focus(),a.submit=!0,b||c.put("/admin/profiles",a.student).success(function(){a.finished=!0}).error(function(){toastr.error("Unable to submit profile.")})},a.saveDraft=function(){c.put("/admin/drafts",a.student).success(function(b){toastr.success("Draft saved successfully!"),a.student=b}).error(function(){toastr.warning("There were issues saving your draft.")})}}]),angular.module("gmaApp").controller("AdminListCtrl",["$scope","Persona","$http","$location",function(a,b,c,d){switch(b.status(),a.getClients=function(){c.get("/admin/clients").then(function(b){a.profiles=b.data.result})},a.getProspects=function(){c.get("/admin/prospects").then(function(b){a.profiles=b.data.result})},d.search().clients){case"true":a.getClients(),a.clients=!0;break;case"false":default:a.getProspects(),a.clients=!1}a.type=a.clients?"Clients":"Prospects",a.viewProfile=function(a){d.path("/admin/profiles/"+a._id)},a.destroy=function(b){a.clients||confirm("Are you sure you want to delete this prospect?")&&c.delete("/admin/prospects/"+b._id).success(function(){toastr.success("Prospect deleted."),a.getProspects()}).error(function(){toastr.error("Unable to delete Prospect.")})}}]),angular.module("gmaApp").controller("AdminViewCtrl",["$scope","$route","$http","$location","Persona","$modal","states","AssetTypes","OwnershipTypes","LiabilityTypes","RetirementTypes",function(a,b,c,d,e,f,g,h,i,j,k){e.status(),a.mode=d.search().mode;var l=b.current.params.profile;c.get("/admin/profiles/"+l).then(function(b){a.student=b.data,a.clients=a.student.hasOwnProperty("prospect")&&0==a.student.prospect?!0:!1,a.student.hasOwnProperty("siblings")||(a.student.siblings={schools:[]})}),a.moreInfo=!0,a.$on("$routeUpdate",function(){a.mode=d.search().mode}),a.credentials={studentFAFSA:!1,parentFAFSA:!1,cssUsername:!1,cssPassword:!1},a.partial=function(){switch(a.mode){case"edit":return"assets/views/admin/drafts/partial/edit.html";case"css":return"assets/views/admin/profiles/partial/css.html";case"fafsa":return"assets/views/admin/profiles/partial/fafsa.html";case"report":default:return"assets/views/admin/profiles/partial/report.html"}},a.changeMode=function(a){d.search("mode",a)},a.type=function(){switch(a.mode){case"edit":return"Profile";case"css":return"CSS Profile";case"fafsa":return"FAFSA Profile";case"summary":default:return"Summary"}},a.triggerDownload=function(){window.open("/admin/dl/"+l)},a.showStudentAssets=function(){f.open({templateUrl:"assets/views/admin/profiles/modal/assets.html",controller:"StudentAssetModal",resolve:{assets:function(){return a.student.family.assets}}})},a.showParentAssets=function(){f.open({templateUrl:"assets/views/admin/profiles/modal/parentsAssets.html",controller:"ParentAssetModal",resolve:{assets:function(){return a.student.family.assets}}})},a.showRetirementAssets=function(){f.open({templateUrl:"assets/views/admin/profiles/modal/parentsAssets.html",controller:"ParentAssetModal",resolve:{assets:function(){return a.student.family.retirement}}})},a.notifyUser=function(){c.get("admin/notify/moreinfo/"+l).success(function(b){a.student=b.result,toastr.success("Notification email sent!")}).error(function(){toastr.error("Unable to send notification email.")})},a.states=g,a.currentSchool=null,a.currentSibSchool=null,a.collegeList=[],a.collegeSibList=[],a.collegesLoading=!1,a.$watch("currentSchool",function(){""!=a.currentSchool&&"object"!=typeof a.currentSchool&&(a.collegesLoading=!0,c.post("/colleges.json",{name:a.currentSchool}).then(function(b){a.collegeList=b.data,a.collegesLoading=!1}))}),a.$watch("currentSibSchool",function(){""!=a.currentSibSchool&&"object"!=typeof a.currentSibSchool&&(a.collegesLoading=!0,c.post("/colleges.json",{name:a.currentSibSchool}).then(function(b){a.collegeSibList=b.data,a.collegesLoading=!1}))}),a.ownershipTypes=i,a.liabilityTypes=j,a.assetTypes=h,a.retirementTypes=k,a.addSchool=function(b){b===!0?(a.student.siblings.schools.push(a.currentSibSchool),a.currentSibSchool=null):(a.student.schools.push(a.currentSchool),a.currentSchool=null)},a.updateSchool=function(b,c,d){d===!0?a.currentSibSchool=b:a.currentSchool=b},a.deleteSchool=function(b,c){c?a.student.siblings.schools.splice(b,1):a.student.schools.splice(b,1)},a.addFamily=function(){a.student.family.members.push({student:!1})},a.deleteFamily=function(b){a.student.family.members.splice(b,1)},a.addProperty=function(){a.student.family.realEstate.push({})},a.deleteProperty=function(b){a.student.family.realEstate.splice(b,1)},a.addAsset=function(){a.student.family.assets.push({})},a.deleteAsset=function(b){a.student.family.assets.splice(b,1)},a.addLiability=function(){a.student.family.liabilities.push({})},a.deleteLiability=function(b){a.student.family.liabilities.splice(b,1)},a.addRetirement=function(){a.student.family.retirement.push({})},a.deleteRetirement=function(b){a.student.family.retirement.splice(b,1)},a.setClient=function(){a.student.prospect=!1,c.put("/admin/prospects/"+a.student._id,a.student).success(function(b){a.student=b.result,a.clients=a.student.hasOwnProperty("prospect")&&0==a.student.prospect?!0:!1,toastr.success("Client updated successfully")}).error(function(){toastr.error("Unable to update account.")})},a.submitProfile=function(){var b=!1;jQuery(".has-error").removeClass("has-error"),jQuery(".ng-invalid").each(function(){b=!0,jQuery(this).parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".btn.ng-invalid").each(function(){b=!0,jQuery(this).parent(".btn-group").parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".input-group>.ng-invalid").each(function(){b=!0,jQuery(this).parent(".input-group").parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".ng-invalid:not(form)").first().focus(),a.submit=!0,b||c.put("/admin/profiles",a.student).success(function(b){a.student=b.result,toastr.success("Profile updated.")}).error(function(){toastr.error("Unable to update profile.")})}}]),angular.module("gmaApp").controller("StudentAssetModal",["$scope","$modalInstance","assets",function(a,b,c){a.assets=[];for(d in c){var d=c[d];"Student"==d.owner&&a.assets.push(d)}a.close=function(){b.close()}}]),angular.module("gmaApp").controller("ParentAssetModal",["$scope","$modalInstance","assets",function(a,b,c){a.assets=[];for(d in c){var d=c[d];"Student"!=d.owner&&a.assets.push(d)}a.close=function(){b.close()}}]),angular.module("gmaApp").controller("AdminDraftListCtrl",["$scope","Persona","$http","$location","$route",function(a,b,c,d){b.status(),c.get("/admin/drafts").then(function(b){a.profiles=b.data.result,a.pagination=b.data.pagination}),a.sortable={"user.name.last":!1,"user.name.first":!1,"name.last":!1,"name.first":!1,hsGrad:!1,created_at:!1,updated_at:!1},a.checkSort=function(b){return a.sortable[b]},a.sortClass=function(b){var c=a.sortable[b];if(c!==!1)return"asc"==c?"icon-caret-up":"desc"==c?"icon-caret-down":void 0},a.changeSort=function(b){var c=a.sortable[b];c===!1?a.sortable[b]="asc":"desc"==c?a.sortable[b]="asc":"asc"==c&&(a.sortable[b]="desc"),a.newPage(1)},a.clearSort=function(b){a.sortable[b]=!1,a.newPage(1)},a.viewDraft=function(a){d.path("/admin/drafts/"+a._id)},a.newPage=function(b){toastr.info("","Loading",{timeOut:0,extendedTimeOut:0});var d=[];for(var e in a.sortable){var f=a.sortable[e];("asc"==f||"desc"==f)&&d.push(e+":"+f)}c.get("/admin/drafts?page="+b+"&sort="+d.join(",")).then(function(b){a.$$phase?(a.profiles=b.data.result,a.pagination=b.data.pagination):a.$digest(function(){a.profiles=b.data.result,a.pagination=b.data.pagination}),toastr.clear()})}}]),angular.module("gmaApp").controller("AdminDraftViewCtrl",["$scope","$route","$http","$location","Persona","states","AssetTypes","OwnershipTypes","LiabilityTypes","RetirementTypes","$modal",function(a,b,c,d,e,f,g,h,i,j,k){e.status(),a.mode=d.search().mode,a.profileCreated=!1,a.moreInfo=!0,a.states=f,a.ownershipTypes=h,a.liabilityTypes=i,a.assetTypes=g,a.retirementTypes=j;var l=b.current.params.profile;c.get("/admin/drafts/"+l).then(function(b){a.student=b.data.result,a.student.hasOwnProperty("siblings")||(a.student.siblings={schools:[]})}),a.$on("$routeUpdate",function(){a.mode=d.search().mode}),a.currentSchool=null,a.currentSibSchool=null,a.collegeList=[],a.collegeSibList=[],a.collegesLoading=!1,a.$watch("currentSchool",function(){""!=a.currentSchool&&"object"!=typeof a.currentSchool&&(a.collegesLoading=!0,c.post("/colleges.json",{name:a.currentSchool}).then(function(b){a.collegeList=b.data,a.collegesLoading=!1}))}),a.$watch("currentSibSchool",function(){""!=a.currentSibSchool&&"object"!=typeof a.currentSibSchool&&(a.collegesLoading=!0,c.post("/colleges.json",{name:a.currentSibSchool}).then(function(b){a.collegeSibList=b.data,a.collegesLoading=!1}))}),a.addSchool=function(b){b===!0?(a.student.siblings.schools.push(a.currentSibSchool),a.currentSibSchool=null):(a.student.schools.push(a.currentSchool),a.currentSchool=null)},a.updateSchool=function(b,c,d){d===!0?a.currentSibSchool=b:a.currentSchool=b},a.deleteSchool=function(b,c){c?a.student.siblings.schools.splice(b,1):a.student.schools.splice(b,1)},a.addFamily=function(){a.student.family.members.push({student:!1})},a.deleteFamily=function(b){a.student.family.members.splice(b,1)},a.addProperty=function(){a.student.family.realEstate.push({})},a.deleteProperty=function(b){a.student.family.realEstate.splice(b,1)},a.addAsset=function(){a.student.family.assets.push({})},a.deleteAsset=function(b){a.student.family.assets.splice(b,1)},a.addLiability=function(){a.student.family.liabilities.push({})},a.deleteLiability=function(b){a.student.family.liabilities.splice(b,1)},a.addRetirement=function(){a.student.family.retirement.push({})},a.deleteRetirement=function(b){a.student.family.retirement.splice(b,1)},a.partial=function(){switch(a.mode){case"edit":return"assets/views/admin/drafts/partial/edit.html";case"view":default:return"assets/views/admin/profiles/partial/report.html"}},a.changeMode=function(b){"edit"==a.mode&&jQuery("form").hasClass("ng-dirty")&&!a.submit?confirm("Are you sure you want to change modes without saving?")&&d.search("mode",b):d.search("mode",b)},a.saveDraft=function(){c.put("/admin/drafts/"+l,a.student).success(function(){toastr.success("Draft saved.")}).error(function(){toastr.error("Unable to save draft.")})},a.submitProfile=function(){var b=!1;jQuery(".has-error").removeClass("has-error"),jQuery(".ng-invalid").each(function(){b=!0,jQuery(this).parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".btn.ng-invalid").each(function(){b=!0,jQuery(this).parent(".btn-group").parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".input-group>.ng-invalid").each(function(){b=!0,jQuery(this).parent(".input-group").parent(".control").parent(".form-group").addClass("has-error")}),jQuery(".ng-invalid:not(form)").first().focus(),a.submit=!0,b||(a.profileCreated?c.put("/admin/profiles",a.student).success(function(b){a.student=b.result,toastr.success("Profile updated.")}).error(function(){toastr.error("Unable to update profile.")}):c.post("/admin/profiles",a.student).success(function(a){d.search("mode",null),d.path("/admin/profiles/"+a.result._id)}))},a.changeOwner=function(){var b=k.open({templateUrl:"assets/views/admin/drafts/modal/changeOwner.html",controller:"ChangeOwnerCtrl",resolve:{draft:function(){return a.student}}});b.result.then(function(){c.get("/admin/drafts/"+l).then(function(b){a.student=b.data.result})})}}]),angular.module("gmaApp").controller("ChangeOwnerCtrl",["$rootScope","$scope","$modalInstance","$http","draft",function(a,b,c,d,e){b.data={draft:e},b.users={list:[]},b.user={name:null,isSelected:!1,selected:{}},b.$watch("user.name",function(a){void 0!==a&&""!==a&&d.get("/admin/users",{params:{name:b.user.name}}).success(function(a){b.users.list=a.result})}),b.updateUser=function(a){b.user.isSelected=!0,b.user.selected=a},b.doUpdateUser=function(){d({method:"PATCH",url:"/admin/drafts/"+b.data.draft._id,data:{user_id:b.user.selected._id}}).success(function(){c.close(),toastr.success("Draft reassigned successfully")})},b.$on("newUserCreate",function(a,c){b.user.selected=c,b.doUpdateUser()}),b.close=function(){c.close()}}]),angular.module("gmaApp").controller("NewUserFormCtrl",["$scope","$rootScope","$http",function(a,b,c){a.newUser={},a.tryCreateUser=function(){a.userForm.$valid&&c.post("/accounts",a.newUser).success(function(b,c){201==c&&(toastr.success("New user created successfully."),a.$emit("newUserCreate",b))}).error(function(b,c){409==c&&(a.userForm.email.$setValidity(!1),toastr.error("This email address belongs to an existing user."))})}}]),angular.module("gmaApp").controller("AdminUserListCtrl",["$scope","$location","$http","Persona",function(a,b,c,d){d.status(),c.get("/admin/users").then(function(b){a.users=b.data.result,a.pagination=b.data.pagination}),a.sortable={"name.last":!1,"name.first":!1,created_at:!1},a.checkSort=function(b){return a.sortable[b]},a.sortClass=function(b){var c=a.sortable[b];if(c!==!1)return"asc"==c?"icon-caret-up":"desc"==c?"icon-caret-down":void 0},a.changeSort=function(b){var c=a.sortable[b];c===!1?a.sortable[b]="asc":"desc"==c?a.sortable[b]="asc":"asc"==c&&(a.sortable[b]="desc"),a.newPage(1)},a.clearSort=function(b){a.sortable[b]=!1,a.newPage(1)},a.viewUser=function(a){b.path("/admin/users/"+a._id)},a.newPage=function(b){toastr.info("","Loading",{timeOut:0,extendedTimeOut:0});var d=[];for(var e in a.sortable){var f=a.sortable[e];("asc"==f||"desc"==f)&&d.push(e+":"+f)}c.get("/admin/users?page="+b+"&sort="+d.join(",")).then(function(b){a.$$phase?(a.users=b.data.result,a.pagination=b.data.pagination):a.$digest(function(){a.users=b.data.result,a.pagination=b.data.pagination}),toastr.clear()})}}]),angular.module("gmaApp").controller("AdminUserViewCtrl",["$scope","$route","$http","$location",function(a,b,c,d){var e=b.current.params.user;c.get("/admin/users/"+e).then(function(b){a.user=b.data.result,a.drafts=b.data.result.drafts,a.profiles=b.data.result.profiles}),a.changeGroup=function(b){c.put("/admin/users/"+e,{role:b}).success(function(b){a.user=b.result,toastr.success("","User updated successfully!")}).error(function(){toastr.error("","Unable to update user.")})},a.viewDraft=function(a){d.path("/admin/drafts/"+a._id)},a.viewProfile=function(a){d.path("/admin/profiles/"+a._id)}}]),angular.module("gmaApp").directive("currency",function(){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",ngDisabled:"=",ngRequired:"="},template:'<div class="input-prepend input-append input-group"><span class="input-group-addon">$</span><input type="text" ng-model="ngModel" ng-disabled="ngDisabled" ng-required="ngRequired" class="form-control currency" required><span class="input-group-addon">.00</span></div>',link:function(a,b){jQuery(b).keypress(function(a){var b=[],c=a.which;for(i=48;58>i;i++)b.push(i);b.indexOf(c)>=0||a.preventDefault()})}}}),angular.module("gmaApp.filters").filter("dob",function(){return function(a){if(void 0!=a){var b=a;return b.substr(0,2)+"/"+b.substr(2,2)+"/"+b.substr(4)}}}),angular.module("gmaApp.filters").filter("fullState",function(){return function(a){var b=[{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"American Samoa",abbreviation:"AS"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"District Of Columbia",abbreviation:"DC"},{name:"Federated States Of Micronesia",abbreviation:"FM"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Guam",abbreviation:"GU"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Marshall Islands",abbreviation:"MH"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Northern Mariana Islands",abbreviation:"MP"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Oregon",abbreviation:"OR"},{name:"Palau",abbreviation:"PW"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Puerto Rico",abbreviation:"PR"},{name:"Rhode Island",abbreviation:"RI"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virgin Islands",abbreviation:"VI"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"}],c=jQuery.grep(b,function(b){return b.abbreviation===a});return c.length>0?c[0].name:"State"}}),angular.module("gmaApp.filters").filter("gender",function(){return function(a){var b=a;return"M"==b?"Male":"Female"}}),angular.module("gmaApp.filters").filter("marital",function(){return function(a){if(void 0!=a)switch(a){case"0":case 0:return"Never Married";case 1:case"1":return"Separated";case 2:case"2":return"Widowed";case 3:case"3":return"Divorced";case 4:case"4":return"Remarried";case 5:case"5":return"Married"}}}),angular.module("gmaApp.filters").filter("phone",function(){return function(a){if(void 0!=a){var b=a;return"("+b.substr(0,3)+") "+b.substr(3,3)+"-"+b.substr(6)}}}),angular.module("gmaApp.filters").filter("ssn",function(){return function(a){if(void 0!=a){var b=a;return b.substr(0,3)+"-"+b.substr(3,2)+"-"+b.substr(5)}}}),angular.module("gmaApp").service("OwnershipTypes",function(){return["Personally","Jointly","LLC","S-Corp","Partnership","C-Corp","Other"]}),angular.module("gmaApp").service("LiabilityTypes",function(){return["Car Loan","Credit Card","First Mortgage","Home Equity Line Of Credit","Life Insurance Premium","Other","Second Mortgage"]}),angular.module("gmaApp").service("AssetTypes",function(){return["Annuities (Non Qualified - Not Retirement)","Bonds (including Tax - Exempt)","Business Assets","Cash, Savings","Certificates of Deposit","Checking","Money Market Funds","Mutual Funds","Other Assets","Pre-Paid Tuition Accounts (529 Plans)","Sibling Assets Held By Parents","Stocks","Treasury Bills"]}),angular.module("gmaApp").service("RetirementTypes",function(){return["401(k)","403(b)","IRA","Keogh/SEP/Simple","Pension Fund","Qualified Annuities","Rollover"]}),angular.module("colleges",[]),angular.module("colleges").factory("Colleges",["$http","$q",function(a){var b={getSchool:function(b){return a.get("/colleges/"+b)}};return b}]),angular.module("persona",[]),angular.module("persona").factory("Persona",["$http","$q",function(a,b){var c={user:{},getUser:function(){return c.user.hasOwnProperty("email")?c.user:!1},verify:function(){var d=b.defer();return navigator.id.get(function(b){a.post("/persona/verify",{assertion:b}).then(function(a){"okay"!=a.data.status?d.reject(a.data.reason):(c.user=a.data.user,d.resolve(a.data.email))})}),d.promise},logout:function(){return a.post("/persona/logout").then(function(a){return c.user={},"okay"!=a.data.status&&b.reject(a.data.reason),a.data.email})},status:function(){a.post("/persona/status").then(function(a){return c.user=a.data.user,c.user})}};return c.status(),c}]),angular.module("gmaApp").service("states",function(){var a=[{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"American Samoa",abbreviation:"AS"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"District Of Columbia",abbreviation:"DC"},{name:"Federated States Of Micronesia",abbreviation:"FM"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Guam",abbreviation:"GU"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Marshall Islands",abbreviation:"MH"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Northern Mariana Islands",abbreviation:"MP"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Oregon",abbreviation:"OR"},{name:"Palau",abbreviation:"PW"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Puerto Rico",abbreviation:"PR"},{name:"Rhode Island",abbreviation:"RI"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virgin Islands",abbreviation:"VI"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"}];
return a});